% !TEX encoding   = UTF8
% !TEX spellcheck = ru_RU
% !TEX root = ../seminars.tex

%%==================================================
\chapter{Графическое представление функций и данных}
%%==================================================

%%==========================================
\section{Улучшение класса \texttt{Function}}
%%==========================================
Представим вариант выполнения упражения~2 из~\textbookref{главы~15}.

\cppfile[firstline=11, lastline=29]{projects/ch15/function.cpp}

Первый раз основную работу по~вычислению и сохранению точек выполняет конструктор базового класса \code{Function}. Нам остаётся сохранить параметры, задающие вид кривой:

\cppfile[firstline=31, lastline=36]{projects/ch15/function.cpp}

Метод \code{move()} перекрывает \code{Shape::move()}, чтобы сдвинуть начало координат для~правильного вычисления точек кривой, если будут внесены какие-либо дополнительные изменения (форма кривой, диапазон рисования, и т.\,д.):

\cppfile[firstline=38, lastline=43]{projects/ch15/function.cpp}

Следующие функции позволяют пользователю изменить вид кривой:

\cppfile[firstline=45, lastline=64]{projects/ch15/function.cpp}

Основную работу при~этом выполняет закрытая функция \code{redistribute()}, которая вычисляет точки кривой заново:

\cppfile[firstline=66, lastline=75]{projects/ch15/function.cpp}

Заметим, что хранение точек в~классе \code{Shape} (подобно тому, как это делает \code{Graph\_}\-\code{lib::Function}) не~позволяет нам уменьшить их количество. По~этой причине мы не~предоставляем пользователю возможность изменять число точек.

Как и всегда, необходимо протестировать новые возможности, например, так:

\cppfile[firstline=116, lastline=133]{projects/ch15/function.cpp}



%%===================
\input{ch15/functors}
%%===================



%%==========================================
\section{Визуализация данных. Аппроксимация}
%%==========================================
В~самом начале мы разбирали метод наименьших квадратов (см.~страницу~\pageref{sect:leastsquares}) для~аппроксимации массива экспериментальных данных. По~аналогии с~материалом \textbookref{главы~15} представим эти данные графически, а также нанесём на график кривые, аппроксимирующие их.

В~качестве реализации метода наименьших квадратов возьмём ранее написанный код. Разместим его в~файлах \code{least\_squares.h} и \code{least\_squares.cpp}. Функции и классы поместим в~отдельное пространство имён \code{lsm}.

Приведём лишь ключевые моменты кода (файл \code{main.cpp}), выполняющего визуализацию. Размеры и положение окна, осей, масштабирующие множители и прочее предлагаем определить самостоятельно, опираясь на~материал учебника.

Добавление данных в~виде точек, отмеченных маркером:

\cppfile[firstline=85, lastline=89]{projects/ch15/least_squares/main.cpp}

\noindent Переменные \code{xs} и \code{ys} "--- объекты класса \code{Scale}, описанного в~\textbookref{главе~15}.

Добавление прямой, коэффициенты которой получены методом наименьших квадратов по исходным данным (из~файла \code{data.txt}):

\cppfile[firstline=94, lastline=104]{projects/ch15/least_squares/main.cpp}

Отметим, что в~регрессионной модели (\ref{eq:linearmodel}) рассмотрен частный случай \(f(x_i) = x_i\). Однако все рассуждения и приведённые выкладки остаются справедливыми и в~том случае, если функция \(f(x_i)\) не~является линейной. Поэтому мы внесли небольшую модификацию в~\code{least\_squares()}, добавив функцию как параметр (файл \code{least\_squares.h}):

\cppfile[firstline=45, lastline=45]{projects/ch15/least_squares/least_squares.h}
\cppfile[firstline=54, lastline=54]{projects/ch15/least_squares/least_squares.h}

Функция \code{linear()} задаёт линейную базисную функцию \(f(x_i) = x_i\), протягивая ниточку к~начальной реализации (\code{main.cpp}):

\cppfile[firstline=14, lastline=14]{projects/ch15/least_squares/main.cpp}

\begin{figure}[h]
    {\centering
        \includegraphics[width=0.6\textwidth]{images/least_squares_graphing.png}

    }
    \caption{Графическое представление данных}
\end{figure}

Вспомогательная функция \code{make\_regression()} создаёт лямбда-выражение, вычисляющее точки аппроксимирующей кривой. При~этом коэффициенты \(a\) и \(b\) скрыты в~реализации объекта лямбда-выражения:

\cppfile[firstline=26, lastline=29]{projects/ch15/least_squares/main.cpp}

Добавьте подпись кривой на~график "--- уравнение модели с~вычисленными коэффициентами. Далее, по аналогии добавьте модель с~нелинейной базисной функцией.



%%================
\WhatToReadSection
%%================
\textcite{Stroustrup:2016:ru}: \textbf{глава~16}



%%===============
\ExercisesSection
%%===============
\begin{exercise}
\item Выполните упражнения из \textbookref{главы~15} учебника.

\end{exercise}
